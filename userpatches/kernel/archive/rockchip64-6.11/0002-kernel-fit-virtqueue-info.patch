From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: John Doe <john.doe@somewhere.on.planet>
Date: Sat, 28 Sep 2024 08:07:08 +0000
Subject: update virtio_ivshmem.c to fit latest virtqueue_info on
 virtio_config_ops.find_vqs

Signed-off-by: John Doe <john.doe@somewhere.on.planet>
---
 drivers/virtio/virtio_ivshmem.c | 12 ++++------
 1 file changed, 5 insertions(+), 7 deletions(-)

diff --git a/drivers/virtio/virtio_ivshmem.c b/drivers/virtio/virtio_ivshmem.c
index 1fa08906fe81..750081de7641 100644
--- a/drivers/virtio/virtio_ivshmem.c
+++ b/drivers/virtio/virtio_ivshmem.c
@@ -513,22 +513,20 @@ static void vi_del_vqs(struct virtio_device *vdev)
 	vi_dev->queues_irq_name = NULL;
 }
 
 static int vi_find_vqs(struct virtio_device *vdev, unsigned nvqs,
 		       struct virtqueue *vqs[],
-		       vq_callback_t *callbacks[],
-		       const char * const names[],
-		       const bool *ctx,
+      		   struct virtqueue_info vqs_info[],
 		       struct irq_affinity *desc)
 {
 	struct virtio_ivshmem_device *vi_dev = to_virtio_ivshmem_device(vdev);
 	unsigned int vq_vector, desired_vectors;
 	int err, vectors, i, queue_idx = 0;
 
 	desired_vectors = 1; /* one for config events */
 	for (i = 0; i < nvqs; i++)
-		if (callbacks[i])
+		if (vqs_info[i].callback)
 			desired_vectors++;
 
 	vectors = pci_alloc_irq_vectors(vi_dev->pci_dev, desired_vectors,
 					desired_vectors, PCI_IRQ_MSIX);
 	if (vectors != desired_vectors) {
@@ -578,17 +576,17 @@ static int vi_find_vqs(struct virtio_device *vdev, unsigned nvqs,
 		if (err)
 			goto error_queues_irq;
 	}
 
 	for (i = 0; i < nvqs; ++i) {
-		if (!names[i]) {
+		if (!vqs_info[i].name) {
 			vqs[i] = NULL;
 			continue;
 		}
 
-		vqs[i] = vi_setup_vq(vdev, queue_idx++, callbacks[i], names[i],
-				     ctx ? ctx[i] : false, vq_vector);
+		vqs[i] = vi_setup_vq(vdev, queue_idx++, vqs_info[i].callback, vqs_info[i].name,
+				     vqs_info[i].ctx, vq_vector);
 		if (IS_ERR(vqs[i])) {
 			vi_del_vqs(vdev);
 			return PTR_ERR(vqs[i]);
 		}
 
-- 
Created with Armbian build tools https://github.com/armbian/build

