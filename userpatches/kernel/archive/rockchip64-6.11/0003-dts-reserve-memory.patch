From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: John Doe <john.doe@somewhere.on.planet>
Date: Sun, 29 Sep 2024 01:25:38 +0800
Subject: reserve memory for jailhouse

Signed-off-by: John Doe <john.doe@somewhere.on.planet>
---
 arch/arm64/boot/dts/rockchip/rk3308-rock-pi-s.dts | 19 ++++++++++
 1 file changed, 19 insertions(+)

diff --git a/arch/arm64/boot/dts/rockchip/rk3308-rock-pi-s.dts b/arch/arm64/boot/dts/rockchip/rk3308-rock-pi-s.dts
index 62d18ca769a1..e2daae393d72 100644
--- a/arch/arm64/boot/dts/rockchip/rk3308-rock-pi-s.dts
+++ b/arch/arm64/boot/dts/rockchip/rk3308-rock-pi-s.dts
@@ -22,10 +22,29 @@ aliases {
 
 	chosen {
 		stdout-path = "serial0:1500000n8";
 	};
 
+	// the board should contain 512MB memory, with last 12 MB reserved for jailhouse
+	// 512M DDR3/LPDDR3 address: 0x0000 0000 - 0x2000 0000
+	// top 8 MB reserved from jailhouse hypervisor, it should be 0x20000000 - 0x800000 = 0x1f800000
+	// 4 MB for inmate, then it should be 0x1f800000 - 0x400000 = 0x1f400000
+	reserved-memory {
+		#address-cells = <2>;
+		#size-cells = <2>;
+		ranges;
+		jailhouse@5f800000 {
+			reg = <0x0 0x1f800000 0x0 0x00800000>;
+			no-map;
+		};
+
+		jh_inmate@5f400000 {
+			reg = <0x0 0x1f400000 0x0 0x00400000>;
+			no-map;
+		};
+	};
+
 	leds {
 		compatible = "gpio-leds";
 		pinctrl-names = "default";
 		pinctrl-0 = <&green_led>, <&heartbeat_led>;
 
-- 
Created with Armbian build tools https://github.com/armbian/build

